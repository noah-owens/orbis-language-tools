{
	"$schema":"https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name":"Orbis Definition Language",
	"patterns":[
		{
			"include":"#entity-block"
		},
		{
			"include":"#trait-block"
		},
		{
			"include":"#command-block"
		},
		{
			"include":"#common"
		}
	],
	"repository":{
		"entity-block":{
			"begin":"\\b(entity)\\b\\s+(\\w+)\\s*\\{",
			"beginCaptures":{
				"1":{
					"name":"keyword.declaration.entity.orbis"
				},
				"2":{
					"name":"entity.name.type.entity.orbis"
				}
			},
			"patterns":[
				{
					"include":"#common"
				},
				{
					"include":"#trait-block"
				},
				{
					"include":"#component-block"
				},
				{
					"include":"#react-block"
				}
			],
			"end":"\\}",
			"name":"meta.block.entity.orbis"
		},
		"component-block":{
			"begin":"\\b(component)\\b\\s+(\\w+)\\s*\\{",
			"beginCaptures":{
				"1":{
					"name":"keyword.declaration.component.orbis"
				},
				"2":{
					"name":"entity.name.type.component.orbis"
				}
			},
			"patterns":[
				{
					"include":"#common"
				}
			],
			"end":"\\}",
			"name":"meta.block.component.orbis"
		},
		"trait-reference":{
			"patterns":[
				{
					"name":"support.type.trait.reference.orbis",
					"match":"\\btrait\\b\\s+(\\w+)\\s*$",
					"captures":{
						"0":{
							"name":"meta.trait.reference.orbis"
						},
						"1":{
							"name":"entity.name.trait.reference.orbis"
						}
					}
				}
			]
		},
		"trait-block":{
			"begin":"\\btrait\\b\\s+(\\w+)\\s*\\{",
			"beginCaptures":{
				"0":{
					"name":"keyword.declaration.trait.orbis"
				},
				"1":{
					"name":"entity.name.type.trait.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.block.trait.orbis",
			"patterns":[
				{
					"include":"#common"
				},
				{
					"include":"#component-block"
				},
				{
					"include":"#react-block"
				}
			]
		},
		"command-block":{
			"begin":"\\bcommand\\b\\s+(\\w+)\\s*\\{",
			"beginCaptures":{
				"0":{
					"name":"keyword.declaration.command.orbis"
				},
				"1":{
					"name":"entity.name.type.command.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.block.command.orbis",
			"patterns":[
				{
					"include":"#field-assignment"
				},
				{
					"include":"#pattern-block"
				},
				{
					"include":"#common"
				}
			]
		},
		"pattern-block":{
			"begin":"\\bpattern\\b\\s*\\{",
			"beginCaptures":{
				"0":{
					"name":"keyword.declaration.pattern.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.block.pattern.orbis",
			"patterns":[
				{
					"include":"#field-assignment"
				},
				{
					"include":"#strings"
				},
				{
					"include":"#interpolation"
				},
				{
					"include":"#common"
				}
			]
		},
		"react-block":{
			"begin":"\\breact\\b\\s+((?:\\w+\\s*,\\s*)*\\w+)\\s*\\{",
			"beginCaptures":{
				"0":{
					"name":"keyword.declaration.react.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.block.react.orbis",
			"patterns":[
				{
					"begin":"\\breact\\b\\s+((?:\\w+\\s*,\\s*)*\\w+)",
					"beginCaptures":{
						"1":{
							"name":"entity.name.command.orbis"
						}
					},
					"end":"\\{",
					"patterns":[
						{
							"match":"\\b(\\w+)\\b",
							"name":"entity.name.command.orbis"
						},
						{
							"match":",",
							"name":"punctuation.separator.command.orbis"
						}
					]
				},
				{
					"include":"#control-block"
				}
			]
		},
		"control-block":{
			"patterns":[
				{
					"include":"#when-block"
				},
				{
					"include":"#then-block"
				},
				{
					"include":"#expr-block"
				}
			]
		},
		"when-block":{
			"begin":"\\b(when)\\b\\s*\\{",
			"beginCaptures":{
				"1":{
					"name":"keyword.control.when.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.block.control.when.orbis",
			"patterns":[
				{
					"include":"#common"
				},
				{
					"include":"#react-internals"
				},
				{
					"include":"#field-assignment"
				},
				{
					"include":"#expr-block"
				}
			]
		},
		"then-block":{
			"begin":"\\b(then)\\b\\s*\\{",
			"beginCaptures":{
				"1":{
					"name":"keyword.control.then.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.block.control.then.orbis",
			"patterns":[
				{
					"include":"#common"
				},
				{
					"include":"#react-internals"
				},
				{
					"include":"#field-assignment"
				},
				{
					"include":"#expr-block"
				}
			]
		},
		"expr-block":{
			"begin":"\\b(expr)\\b\\s*\\{",
			"beginCaptures":{
				"1":{
					"name":"keyword.control.expr.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.block.control.expr.orbis",
			"patterns":[
				{
					"include":"#common"
				},
				{
					"include":"#react-internals"
				},
				{
					"include":"#field-assignment"
				}
			]
		},
		"react-internals":{
			"patterns":[
				{
					"include":"#set-assignment"
				},
				{
					"include":"#actions"
				},
				{
					"include":"#dot-selectors"
				},
				{
					"include":"#selectors"
				}
			]
		},
		"actions":{
			"patterns":[
				{
					"name":"keyword.control.print.orbis",
					"match":"\\bprint\\b"
				},
				{
					"name":"keyword.control.copy.orbis",
					"match":"\\bcopy\\b"
				},
				{
					"name":"keyword.control.publish.orbis",
					"match":"\\bpublish\\b"
				},
				{
					"name":"keyword.control.set.orbis",
					"match":"\\bset\\b"
				},
				{
					"name":"keyword.control.move.orbis",
					"match":"\\bmove\\b"
				},
				{
					"name":"keyword.control.reveal.orbis",
					"match":"\\breveal\\b"
				},
				{
					"name":"keyword.control.hide.orbis",
					"match":"\\bhide\\b"
				}
			]
		},
		"dot-selectors":{
			"match":"\\b(source|target|message|instrument|room)\\.(\\w+)\\b",
			"captures":{
				"1":{
					"name":"variable.language.orbis"
				},
				"2":{
					"name":"variable.parameter.orbis"
				}
			}
		},
		"selectors":{
			"name":"variable.language.orbis",
			"match":"\\b(source|target|message|instrument|room)\\b"
		},
		"operators":{
			"name":"keyword.operator.orbis",
			"match":"\\b(contains|and|or|to|not|has)\\b"
		},
		"common":{
			"patterns":[
				{
					"include":"#field-assignment"
				},
				{
					"include":"#trait-reference"
				},
				{
					"include":"#strings"
				},
				{
					"include":"#operators"
				},
				{
					"include":"#booleans"
				},
				{
					"include":"#line-comment"
				},
				{
					"include":"#block-comment"
				}
			]
		},
		"set-assignment":{
			"match":"\\bset\\b\\s+(\\w+)\\.(\\w+)\\s+to\\s+(\\w+)\\.(\\w+)",
			"captures":{
				"1":{
					"name":"variable.language.orbis"
				},
				"2":{
					"name":"variable.field.orbis"
				},
				"3":{
					"name":"variable.language.orbis"
				},
				"4":{
					"name":"variable.field.orbis"
				}
			}
		},
		"field-assignment":{
			"patterns":[
				{
					"include":"#string-field"
				},
				{
					"include":"#numeric-field"
				},
				{
					"include":"#boolean-field"
				},
				{
					"include":"#array-field"
				},
				{
					"include":"#map-field"
				},
				{
					"include":"#paren-expression-field"
				}
			]
		},
		"string-field":{
			"name":"meta.field.assignment.string.orbis",
			"match":"^\\s*(\\w+)\\s+is\\s+(\"[^\"]*\")",
			"captures":{
				"1":{
					"name":"variable.other.assignment.orbis"
				},
				"2":{
					"name":"string.quoted.double.orbis"
				}
			}
		},
		"numeric-field":{
			"name":"meta.field.assignment.numeric.orbis",
			"match":"^\\s*(\\w+)\\s+is\\s+(\\d+(\\.\\d+)?)",
			"captures":{
				"1":{
					"name":"variable.other.assignment.orbis"
				},
				"2":{
					"name":"constant.numeric.orbis"
				}
			}
		},
		"boolean-field":{
			"name":"meta.field.assignment.boolean.orbis",
			"match":"^\\s*(\\w+)\\s+is\\s+(true|false)",
			"captures":{
				"1":{
					"name":"variable.other.assignment.orbis"
				},
				"2":{
					"name":"constant.language.boolean.orbis"
				}
			}
		},
		"array-field":{
			"begin":"^\\s*(\\w+)\\s+is\\s*\\[",
			"beginCaptures":{
				"1":{
					"name":"variable.other.assignment.orbis"
				}
			},
			"end":"\\]",
			"name":"meta.field.assignment.array.orbis",
			"patterns":[
				{
					"name":"string.quoted.double.orbis",
					"match":"\"[^\"]*\""
				},
				{
					"name":"punctuation.separator.array.orbis",
					"match":","
				}
			]
		},
		"map-field":{
			"begin":"^\\s*(\\w+)\\s+is\\s*\\{",
			"beginCaptures":{
				"1":{
					"name":"variable.other.assignment.orbis"
				}
			},
			"end":"\\}",
			"name":"meta.field.assignment.map.orbis",
			"patterns":[
				{
					"name":"string.quoted.key.orbis",
					"match":"\"[^\"]*\"(?=\\s*:)"
				},
				{
					"name":"punctuation.separator.keyvalue.orbis",
					"match":":"
				},
				{
					"name":"string.quoted.value.orbis",
					"match":"(?<=:\\s*)\"[^\"]*\""
				},
				{
					"name":"constant.language.boolean.orbis",
					"match":"(?<=:\\s*)(true|false)\\b"
				},
				{
					"name":"constant.numeric.orbis",
					"match":"(?<=:\\s*)(\\d+(\\.\\d+)?)"
				},
				{
					"name":"punctuation.separator.map.orbis",
					"match":","
				}
			]
		},
		"paren-expression-field":{
			"begin":"^\\s*(\\w+)\\s+is\\s*\\(",
			"beginCaptures":{
				"1":{
					"name":"variable.other.assignment.orbis"
				}
			},
			"end":"\\)",
			"name":"meta.field.assignment.expression.orbis",
			"patterns":[
				{
					"include":"#dot-selectors"
				},
				{
					"include":"#selectors"
				},
				{
					"include":"#operators"
				},
				{
					"name":"constant.numeric.orbis",
					"match":"\\b\\d+(\\.\\d+)?\\b"
				},
				{
					"name":"constant.language.boolean.orbis",
					"match":"\\b(true|false)\\b"
				}
			]
		},
		"interpolation":{
			"name":"meta.interpolation.orbis",
			"begin":"\\{",
			"end":"\\}",
			"patterns":[
				{
					"name":"field.language.orbis",
					"match":"\\b(source|target|message|instrument)\\b"
				},
				{
					"name":"field.property.orbis",
					"match":"\\.(\\w+)\\b"
				},
				{
					"name":"string.unquoted.orbis",
					"match":"'[^']*'"
				},
				{
					"name":"keyword.operator.orbis",
					"match":"\\|"
				},
				{
					"name":"constant.language.style.orbis",
					"match":"\\b(bold|italic|cyan|yellow|red|green)\\b"
				}
			]
		},
		"strings":{
			"name":"string.quoted.double.orbis",
			"begin":"\"",
			"end":"\"",
			"patterns":[
				{
					"name":"constant.character.escape.orbis",
					"match":"\\\\."
				},
				{
					"include":"#interpolation"
				}
			]
		},
		"booleans":{
			"name":"constant.language.boolean.orbis",
			"match":"\\b(true|false)\\b"
		},
		"line-comment":{
			"name":"comment.line.double-slash.orbis",
			"match":"//.*$"
		},
		"block-comment":{
			"name":"comment.block.orbis",
			"begin":"/\\*",
			"end":"\\*/"
		}
	},
	"scopeName":"source.orbis"
}